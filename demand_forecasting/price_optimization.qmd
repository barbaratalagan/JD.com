---
title: "Regression Price Model"
author: "Barbara Talagan"
format: html
editor: visual
---

# Packages
```{r}
library(readxl)
library(openxlsx)
library(tidyverse)
library(tidyr)
library(dplyr)
library(lubridate)
```


# Importing Data
```{r}
excel_file <- "JD_March_2018_data.xlsx"

user_data <- read_excel(excel_file, sheet = "User")
sku_data <- read_excel(excel_file, sheet = "SKU")
order_data <- read_excel(excel_file, sheet = "Order")
inventory_data <- read_excel(excel_file, sheet = "Inventory")
delivery_data <- read_excel(excel_file, sheet = "Delivery")
network_data <- read_excel(excel_file, sheet = "Network")
```

```{r}
regression_data <- order_data %>%
  filter(type == 1) %>%
  mutate(discount = (1-final_unit_price/original_unit_price)) %>%
  group_by(order_date, sku_ID) %>%
  summarize(quantity_sold = sum(quantity),
            avg_original_unit_price = mean(original_unit_price),
            avg_final_unit_price = mean(final_unit_price),
            avg_discount = mean(discount)) %>%
  group_by(sku_ID) %>%
  summarize(daily_avg_q_sold = mean(quantity_sold),
            daily_avg_original_unit_price = mean(avg_original_unit_price),
            daily_avg_final_unit_price = mean(avg_final_unit_price),
            daily_avg_discount = mean(avg_discount)) %>%
  filter(daily_avg_original_unit_price > 0) %>%
  mutate(log_quantity_sold = log(daily_avg_q_sold),
         log_avg_original_unit_price = log(daily_avg_original_unit_price),
         log_avg_final_unit_price = log(daily_avg_final_unit_price),
         log_avg_total_discount = log(daily_avg_discount)) %>%
  filter(!is.infinite(log_avg_total_discount))
```

```{r}
names(regression_data) 
```

```{r}
model <- lm(log_quantity_sold ~ log_avg_original_unit_price + log_avg_total_discount, data = regression_data)
summary(model)
```
```{r}
#write.xlsx(regression_data2, "price_optimization_daily.xlsx")
```

